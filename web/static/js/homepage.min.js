(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){(function(global){"use strict";var _openlayers=typeof window!=="undefined"?window["ol"]:typeof global!=="undefined"?global["ol"]:null;var _openlayers2=_interopRequireDefault(_openlayers);var _map_utils=require("../map_utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var map=(0,_map_utils.getDefaultMap)({zoom:6.5});map.setTarget("map");function hidePreloader(){document.getElementById("preloader").style.display="none"}$(document).ready(function(){var nb_layer_loaded=0;var rapid_inv_geojson=null;var taxa_inv_geojson=null;$.ajax({type:"GET",url:rapid_inventories_url,success:function success(result){rapid_inv_geojson=result.results;for(var i=0;i<rapid_inv_geojson.features.length;i++){rapid_inv_geojson.features[i].properties.type="Inventaire rapide"}nb_layer_loaded+=1;if(nb_layer_loaded==2){addInventoriesLayer(rapid_inv_geojson,taxa_inv_geojson);hidePreloader()}}});$.ajax({xhr:function xhr(){var xhr=new window.XMLHttpRequest;xhr.addEventListener("progress",function(evt){if(evt.lengthComputable){var progr=(evt.loaded/evt.total*100).toFixed(1);progress_bar.setValue(progr);progress_bar.setLabel(progr+"%")}},false);return xhr},type:"GET",url:taxa_inventories_url,success:function success(result){taxa_inv_geojson=result.results;for(var i=0;i<taxa_inv_geojson.features.length;i++){taxa_inv_geojson.features[i].properties.type="Inventaire taxonomique"}nb_layer_loaded+=1;if(nb_layer_loaded==2){addInventoriesLayer(rapid_inv_geojson,taxa_inv_geojson);hidePreloader()}}});function addInventoriesLayer(rapid_inv_geojson,taxa_inv_geojson){var fill="rgba(226, 188, 21, 0.7)";var stroke="#474747";var features=new _openlayers2.default.Collection;var source=new _openlayers2.default.source.Vector({features:features});var vector=new _openlayers2.default.layer.Vector({source:source,style:new _openlayers2.default.style.Style({image:new _openlayers2.default.style.Circle({radius:5,fill:new _openlayers2.default.style.Fill({color:fill}),stroke:new _openlayers2.default.style.Stroke({color:stroke,width:1})})})});source.addFeatures((new _openlayers2.default.format.GeoJSON).readFeatures(rapid_inv_geojson));source.addFeatures((new _openlayers2.default.format.GeoJSON).readFeatures(taxa_inv_geojson));map.addLayer(vector);var hover_interaction=new _openlayers2.default.interaction.Select({condition:_openlayers2.default.events.condition.pointerMove,layers:[vector],updateWhileInteracting:true,style:new _openlayers2.default.style.Style({image:new _openlayers2.default.style.Circle({radius:6,fill:new _openlayers2.default.style.Fill({color:"#66a3ff"}),stroke:new _openlayers2.default.style.Stroke({color:"#cce0ff",width:2})})})});map.addInteraction(hover_interaction);addPopupOverlay(vector)}function addPopupOverlay(layer){var popup=new _map_utils.Popup({positioning:"bottom-center",autoPan:true,autoPanAnimation:{duration:250}});map.addOverlay(popup);var point_select=new _openlayers2.default.interaction.Select({condition:_openlayers2.default.events.condition.click,layers:[layer]});point_select.on("select",function(evt){var selection=point_select.getFeatures();if(selection.getLength()>0){var point=selection.item(0);var coord=point.getGeometry().getCoordinates();var title=point.get("observer_full_name");var content=point.get("type")+" - "+point.get("inventory_date")+" - "+point.get("location_description");popup.show(coord,title,content)}else{popup.hide()}});$(".olext-popup-closer").click(function(){point_select.getFeatures().clear()});map.addInteraction(point_select)}function createProgressBar(container,total,color,suffix,icon,font_size){var bar=new ProgressBar.SemiCircle(container,{color:"#333",strokeWidth:4,trailWidth:1,easing:"easeInOut",duration:1400,text:{autoStyleContainer:false},from:{color:"#aaa",width:1},to:{color:color,width:4},step:function step(state,circle){circle.path.setAttribute("stroke",state.color);circle.path.setAttribute("stroke-width",state.width);var value=Math.round(circle.value()*total);if(value===0){circle.setText("")}else{circle.setText("<i style='font-size: "+font_size+";' class='fa "+icon+"' aria-hidden='true'></i> "+"<span style='font-size: "+font_size+";'>"+value+"</span>"+"<p style='font-size: "+font_size+";'>"+suffix+"</p>")}}});bar.text.style.fontFamily='"Raleway", Helvetica, sans-serif';bar.text.style.fontSize="2rem";bar.animate(1)}createProgressBar("#occurrence_count_container",niamoto_status.nb_occurrences,"#b3de69"," occurrences","fa-pagelines","22px");createProgressBar("#plot_count_container",niamoto_status.nb_plots,"#80b1d3"," parcelles","fa-map-marker","18px");createProgressBar("#provider_count_container",niamoto_status.nb_data_providers,"#969696"," sources","fa-database","18px");createProgressBar("#taxa_count_container",niamoto_status.nb_taxa,"#fb8072"," taxons","fa-leaf","22px");createProgressBar("#inventory_count_container",rapid_inventory_count+taxa_inventory_count,"#8dd3c7"," inventaires","fa-file-text","18px");createProgressBar("#user_count_container",user_count,"#fdb462"," utilisateurs","fa-user","18px")})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../map_utils":2}],2:[function(require,module,exports){(function(global){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getDefaultMap=getDefaultMap;exports.getPolygonArea=getPolygonArea;exports.makeGeoJSONLayer=makeGeoJSONLayer;exports.Popup=Popup;var _openlayers=typeof window!=="undefined"?window["ol"]:typeof global!=="undefined"?global["ol"]:null;var _openlayers2=_interopRequireDefault(_openlayers);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getDefaultMap(options){var options=options||{};var zoom=options.zoom||7.5;var wms_url="http://carto.gouv.nc/arcgis/services/fond_imagerie/"+"MapServer/WMSServer";var view=new _openlayers2.default.View({projection:"EPSG:4326",center:new _openlayers2.default.proj.transform([165.875,-21.145],"EPSG:4326","EPSG:4326"),zoom:zoom});var attribution=new _openlayers2.default.control.Attribution({collapsible:false});var map=new _openlayers2.default.Map({layers:[new _openlayers2.default.layer.Tile({source:new _openlayers2.default.source.TileWMS({url:wms_url,params:{LAYERS:"0",FORMAT:"image/png"},serverType:"mapserver",attributions:[new _openlayers2.default.Attribution({html:'<a href="http://georep.nc/">Géorep</a> '+"- <em>Gouvernement de la "+"Nouvelle-Calédonie</em>"})]})})],view:view,controls:[new _openlayers2.default.control.Zoom,attribution]});return map}function getPolygonArea(map,polygon){var area;var wgs84Sphere=new _openlayers2.default.Sphere(6378137);var sourceProj=map.getView().getProjection();var geom=polygon.clone().transform(sourceProj,"EPSG:4326");var coordinates=geom.getLinearRing(0).getCoordinates();area=Math.abs(wgs84Sphere.geodesicArea(coordinates));return Math.round(area/1e6)}function makeGeoJSONLayer(geojson,opt_options){var options=opt_options||{};var image_vector=options["image_vector"];var source=new _openlayers2.default.source.Vector({features:(new _openlayers2.default.format.GeoJSON).readFeatures(geojson)});options["source"]=source;if(image_vector){return new _openlayers2.default.layer.Image({source:new _openlayers2.default.source.ImageVector(options)})}else{return new _openlayers2.default.layer.Vector(options)}}function Popup(opt_options){var options=opt_options||{};var positioning=opt_options["positioning"];var autoPan=opt_options["autoPan"];var autoPanAnimation=opt_options["autoPanAnimation"];this.hide_callback=opt_options["hide_callback"];this.show_callback=opt_options["show_callback"];this.popup_element=document.createElement("div");this.popup_element.className="olext-popup";this.popup_title=document.createElement("p");this.popup_title.className="olext-popup-title";this.popup_closer=document.createElement("a");this.popup_closer.className="olext-popup-closer";this.popup_closer.href="#";this.popup_content=document.createElement("div");this.popup_content.className="olext-popup-content";this.popup_element.appendChild(this.popup_closer);this.popup_element.appendChild(this.popup_title);this.popup_element.appendChild(this.popup_content);var self=this;this.popup_closer.addEventListener("click",function(evt){self.setPosition(undefined);if(self.hide_callback){self.hide_callback()}});_openlayers2.default.Overlay.call(this,{element:this.popup_element,positioning:positioning,autoPan:autoPan,autoPanAnimation:autoPanAnimation})}_openlayers2.default.inherits(Popup,_openlayers2.default.Overlay);Popup.prototype.show=function(coord,title,content,callback){this.popup_title.innerHTML=title;this.popup_content.innerHTML=content;this.setPosition(coord);if(callback){callback()}else if(this.show_callback){this.show_callback()}return this};Popup.prototype.hide=function(callback){this.setPosition(undefined);if(callback){callback()}else if(this.hide_callback){this.hide_callback()}return this};Popup.prototype.setTitle=function(title){this.popup_title.innerHTML=title};Popup.prototype.setContent=function(content){this.popup_content.innerHTML=content}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}]},{},[1]);
