(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){(function(global){"use strict";var _openlayers=typeof window!=="undefined"?window["ol"]:typeof global!=="undefined"?global["ol"]:null;var _openlayers2=_interopRequireDefault(_openlayers);var _map_utils=require("../map_utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var map=(0,_map_utils.getDefaultMap)();map.setTarget("map");function hidePreloader(){document.getElementById("preloader").style.display="none"}$(document).ready(function(){var nb_layer_loaded=0;$.ajax({type:"GET",url:rapid_inventories_url,success:function success(result){var rapid_inventories_geojson=result.results;addInventoriesLayer(rapid_inventories_geojson,"#e2bc15","#fff1ae");nb_layer_loaded+=1;if(nb_layer_loaded==2){hidePreloader()}}});$.ajax({xhr:function xhr(){var xhr=new window.XMLHttpRequest;xhr.addEventListener("progress",function(evt){if(evt.lengthComputable){var progr=(evt.loaded/evt.total*100).toFixed(1);progress_bar.setValue(progr);progress_bar.setLabel(progr+"%")}},false);return xhr},type:"GET",url:taxa_inventories_url,success:function success(result){var taxa_inventories_geojson=result.results;addInventoriesLayer(taxa_inventories_geojson,"#e25515","#d67f57");nb_layer_loaded+=1;if(nb_layer_loaded==2){hidePreloader()}}});function addInventoriesLayer(inventories_geojson,fill_color,stroke_color){var inventories_layer=(0,_map_utils.makeGeoJSONLayer)(inventories_geojson,{style:new _openlayers2.default.style.Style({image:new _openlayers2.default.style.Circle({radius:5,fill:new _openlayers2.default.style.Fill({color:fill_color}),stroke:new _openlayers2.default.style.Stroke({color:stroke_color,width:1})})})});map.addLayer(inventories_layer);var hover_interaction=new _openlayers2.default.interaction.Select({condition:_openlayers2.default.events.condition.pointerMove,layers:[inventories_layer],updateWhileInteracting:true,style:new _openlayers2.default.style.Style({image:new _openlayers2.default.style.Circle({radius:6,fill:new _openlayers2.default.style.Fill({color:"#66a3ff"}),stroke:new _openlayers2.default.style.Stroke({color:"#cce0ff",width:2})})})});map.addInteraction(hover_interaction);addPopupOverlay(inventories_layer)}function addPopupOverlay(layer){var popup=new _map_utils.Popup({positioning:"bottom-center",autoPan:true,autoPanAnimation:{duration:250}});map.addOverlay(popup);var point_select=new _openlayers2.default.interaction.Select({condition:_openlayers2.default.events.condition.click,layers:[layer]});point_select.on("select",function(evt){var selection=point_select.getFeatures();if(selection.getLength()>0){var point=selection.item(0);var coord=point.getGeometry().getCoordinates();var title=point.get("observer_full_name");var content=point.get("inventory_date")+" - "+point.get("location_description");popup.show(coord,title,content)}else{popup.hide()}});$(".olext-popup-closer").click(function(){point_select.getFeatures().clear()});map.addInteraction(point_select)}})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../map_utils":2}],2:[function(require,module,exports){(function(global){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getDefaultMap=getDefaultMap;exports.getPolygonArea=getPolygonArea;exports.makeGeoJSONLayer=makeGeoJSONLayer;exports.Popup=Popup;var _openlayers=typeof window!=="undefined"?window["ol"]:typeof global!=="undefined"?global["ol"]:null;var _openlayers2=_interopRequireDefault(_openlayers);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getDefaultMap(){var wms_url="http://carto.gouv.nc/arcgis/services/fond_imagerie/"+"MapServer/WMSServer";var view=new _openlayers2.default.View({projection:"EPSG:4326",center:new _openlayers2.default.proj.transform([165.875,-21.145],"EPSG:4326","EPSG:4326"),zoom:7.5});var attribution=new _openlayers2.default.control.Attribution({collapsible:false});var map=new _openlayers2.default.Map({layers:[new _openlayers2.default.layer.Tile({source:new _openlayers2.default.source.TileWMS({url:wms_url,params:{LAYERS:"0",FORMAT:"image/png"},serverType:"mapserver",attributions:[new _openlayers2.default.Attribution({html:'<a href="http://georep.nc/">Géorep</a> '+"- <em>Gouvernement de la "+"Nouvelle-Calédonie</em>"})]})})],view:view,controls:[new _openlayers2.default.control.Zoom,attribution]});return map}function getPolygonArea(map,polygon){var area;var wgs84Sphere=new _openlayers2.default.Sphere(6378137);var sourceProj=map.getView().getProjection();var geom=polygon.clone().transform(sourceProj,"EPSG:4326");var coordinates=geom.getLinearRing(0).getCoordinates();area=Math.abs(wgs84Sphere.geodesicArea(coordinates));return Math.round(area/1e6)}function makeGeoJSONLayer(geojson,opt_options){var options=opt_options||{};var image_vector=options["image_vector"];var source=new _openlayers2.default.source.Vector({features:(new _openlayers2.default.format.GeoJSON).readFeatures(geojson)});options["source"]=source;if(image_vector){return new _openlayers2.default.layer.Image({source:new _openlayers2.default.source.ImageVector(options)})}else{return new _openlayers2.default.layer.Vector(options)}}function Popup(opt_options){var options=opt_options||{};var positioning=opt_options["positioning"];var autoPan=opt_options["autoPan"];var autoPanAnimation=opt_options["autoPanAnimation"];this.hide_callback=opt_options["hide_callback"];this.show_callback=opt_options["show_callback"];this.popup_element=document.createElement("div");this.popup_element.className="olext-popup";this.popup_title=document.createElement("p");this.popup_title.className="olext-popup-title";this.popup_closer=document.createElement("a");this.popup_closer.className="olext-popup-closer";this.popup_closer.href="#";this.popup_content=document.createElement("div");this.popup_content.className="olext-popup-content";this.popup_element.appendChild(this.popup_closer);this.popup_element.appendChild(this.popup_title);this.popup_element.appendChild(this.popup_content);var self=this;this.popup_closer.addEventListener("click",function(evt){self.setPosition(undefined);if(self.hide_callback){self.hide_callback()}});_openlayers2.default.Overlay.call(this,{element:this.popup_element,positioning:positioning,autoPan:autoPan,autoPanAnimation:autoPanAnimation})}_openlayers2.default.inherits(Popup,_openlayers2.default.Overlay);Popup.prototype.show=function(coord,title,content,callback){this.popup_title.innerHTML=title;this.popup_content.innerHTML=content;this.setPosition(coord);if(callback){callback()}else if(this.show_callback){this.show_callback()}return this};Popup.prototype.hide=function(callback){this.setPosition(undefined);if(callback){callback()}else if(this.hide_callback){this.hide_callback()}return this};Popup.prototype.setTitle=function(title){this.popup_title.innerHTML=title};Popup.prototype.setContent=function(content){this.popup_content.innerHTML=content}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}]},{},[1]);
