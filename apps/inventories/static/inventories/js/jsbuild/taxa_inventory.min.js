define("maps",["ol","proj4"],function(e,t){function o(){t.defs("EPSG:32758","+proj=utm +zone=58 +south +datum=WGS84 +units=m +no_defs");var o="http://carto.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer",n="map",r=new e.View({projection:"EPSG:4326",center:new e.proj.transform([165.875,-21.145],"EPSG:4326","EPSG:4326"),zoom:7.5}),a=new e.Map({target:n,layers:[new e.layer.Tile({source:new e.source.TileWMS({url:o,params:{LAYERS:"0",FORMAT:"image/png",CRS:"EPSG:32758"},serverType:"mapserver"})})],view:r,controls:[new e.control.Zoom]});return a}function n(t,o){var n=o||{},r=n.image_vector,a=new e.source.Vector({features:(new e.format.GeoJSON).readFeatures(t)});return n.source=a,r?new e.layer.Image({source:new e.source.ImageVector(n)}):new e.layer.Vector(n)}function r(t){var o=t.positioning,n=t.autoPan,r=t.autoPanAnimation;this.hide_callback=t.hide_callback,this.show_callback=t.show_callback,this.popup_element=document.createElement("div"),this.popup_element.className="olext-popup",this.popup_title=document.createElement("p"),this.popup_title.className="olext-popup-title",this.popup_closer=document.createElement("a"),this.popup_closer.className="olext-popup-closer",this.popup_closer.href="#",this.popup_content=document.createElement("div"),this.popup_content.className="olext-popup-content",this.popup_element.appendChild(this.popup_closer),this.popup_element.appendChild(this.popup_title),this.popup_element.appendChild(this.popup_content);var a=this;this.popup_closer.addEventListener("click",function(e){a.setPosition(void 0),a.hide_callback&&a.hide_callback()}),e.Overlay.call(this,{element:this.popup_element,positioning:o,autoPan:n,autoPanAnimation:r})}return e.inherits(r,e.Overlay),r.prototype.show=function(e,t,o,n){return this.popup_title.innerHTML=t,this.popup_content.innerHTML=o,this.setPosition(e),n?n():this.show_callback&&this.show_callback(),this},r.prototype.hide=function(e){return this.setPosition(void 0),e?e():this.hide_callback&&this.hide_callback(),this},r.prototype.setTitle=function(e){this.popup_title.innerHTML=e},r.prototype.setContent=function(e){this.popup_content.innerHTML=e},{getDefaultMap:o,makeGeoJSONLayer:n,Popup:r}}),require(["jquery","ol","maps","jquery.datetimepicker","jquery.magicsuggest"],function(e,t,o){function n(){var o=e("#long_hidden").val(),n=e("#lat_hidden").val();if(o&&n){var r=[o,n],a=new t.geom.Point(r),s=new t.Feature({name:"inventory",geometry:a});try{c.addFeature(s),c.changed(),l.removeInteraction(d)}catch(e){i.getLength()>0&&l.removeInteraction(d)}}}function r(){document.getElementById("preloader").style.display="inline"}function a(){document.getElementById("preloader").style.display="none"}var l=o.getDefaultMap(),i=new t.Collection,c=new t.source.Vector({features:i}),s=new t.layer.Vector({source:c,style:new t.style.Style({image:new t.style.Circle({radius:5,fill:new t.style.Fill({color:"#e2bc15"}),stroke:new t.style.Stroke({color:"#fff1ae",width:1})})})});s.setMap(l);var d=new t.interaction.Draw({type:"Point",features:i,condition:function(e){var o=t.events.condition.noModifierKeys(e);return o&&0==e.originalEvent.button}});l.addInteraction(d),l.once("click",function(e){l.removeInteraction(d)});var u=new t.interaction.Modify({features:i});l.addInteraction(u);var p=function(e){var o=e||{},n=document.createElement("div");n.className="inline",lat_html=['<label for="_coords_long"  class="control-label required-field">Latitude (WGS84) - Exemple: -20.939244</label>','<div class="">','<input id="_coords_lat" type="number" step="any" class="form-control">',"</div>"],n.innerHTML=lat_html.join(""),n.className="coords_control form-group",t.control.Control.call(this,{element:n,target:o.target,render:function(e){if(i.getLength()>0){var t=i.item(0).getGeometry().getCoordinates();document.getElementById("_coords_lat").value=t[1],document.getElementById("lat_hidden").value=t[1]}}})};t.inherits(p,t.control.Control);var m=function(e){var o=e||{},n=document.createElement("div");n.className="inline",long_html=['<label for="_coords_long"  class="control-label required-field">Longitude (WGS84) - Exemple: 165.344324</label>','<div class="">','<input id="_coords_long" type="number" step="any" class="form-control">',"</div>"],n.innerHTML=long_html.join(""),n.className="coords_control form-group",t.control.Control.call(this,{element:n,target:o.target,render:function(e){if(i.getLength()>0){var t=i.item(0).getGeometry().getCoordinates();document.getElementById("_coords_long").value=t[0],document.getElementById("long_hidden").value=t[0]}}})};t.inherits(m,t.control.Control),l.addControl(new p({target:document.getElementById("lat_long")})),l.addControl(new m({target:document.getElementById("lat_long")})),e(document).ready(function(){e(".form_date").datetimepicker({format:"DD/MM/YYYY"});var t="True"==e("#read_only_hidden").val(),o=e("#magicsuggest").magicSuggest({method:"get",displayField:"full_name",queryParam:"full_name_like",data:taxa_url,maxSelection:null,placeholder:"Saisissez un nom de taxon",allowFreeEntries:!1,noSuggestionText:"Aucun taxon correspondant",cls:"dropup",selectionPosition:"bottom",selectionRenderer:function(e){return e.full_name},disabled:t,useZebraStyle:!0,value:taxa_value});e(o).on("selectionchange",function(t){e("#taxa_hidden").val(JSON.stringify(o.getSelection()))}),e(o).on("beforeload",function(e){r()}),e(o).on("load",function(e){a()}),e("#_coords_long").change(function(t){var o=e("#_coords_long").val();if(document.getElementById("long_hidden").value=o,i.getLength()>0){var r=i.item(0),a=r.getGeometry().getCoordinates();r.getGeometry().setCoordinates([o,a[1]])}else n()}),e("#_coords_lat").change(function(t){var o=e("#_coords_lat").val();if(document.getElementById("lat_hidden").value=o,i.getLength()>0){var r=i.item(0),a=r.getGeometry().getCoordinates();r.getGeometry().setCoordinates([a[0],o])}else n()}),n(),"True"==e("#read_only_hidden").val()&&(e("#_coords_lat").attr("readonly",!0),e("#_coords_long").attr("readonly",!0),l.removeInteraction(u),e("#inventory_form").submit(!1))})}),define("taxa_inventory",function(){});