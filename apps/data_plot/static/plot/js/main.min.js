(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){(function(global){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Gauge=void 0;typeof window!=="undefined"?window["d3"]:typeof global!=="undefined"?global["d3"]:null;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var Gauge=function(){function Gauge(configuration){var _this=this;_classCallCheck(this,Gauge);var config={height:200,width:200,margin:10,minValue:0,maxValue:10,majorTicks:5,lowThreshhold:.2,lowMidThreshhold:.4,highMidThreshhold:.6,highThreshhold:.8,lowThreshholdColor:"#f02828",lowMidThreshholdColor:"#fe6a00",defaultColor:"#e8dd11",highMidThreshholdColor:"#82e042",highThreshholdColor:"#089f50",container:"",transitionMs:500};this.config=Object.assign(config,configuration);this.margin={top:this.config.height*.1,right:this.config.width*.05,bottom:this.config.height*-.05,left:this.config.width*.05};this.mheight=this.config.height-this.margin.top-this.margin.bottom;this.mwidth=this.config.width-this.margin.left-this.margin.right;this.arcPadding=this.mwidth*.075;this.arcWidth=this.mwidth*.1;this.labelInset=this.mwidth*.05;var pointerWidth=this.mwidth*.025;var pointerTailLength=this.mwidth*.025;var pointerHeadLength=this.mwidth*.4;this.lineData=[[pointerWidth,0],[0,-pointerHeadLength],[-pointerWidth,0],[0,pointerTailLength],[pointerWidth,0]];this.minAngle=-90,this.maxAngle=90,this.angleRange=this.maxAngle-this.minAngle;this.scale=d3.scaleLinear().range([0,1]).domain([config.minValue,config.maxValue]);var colorDomain=[(config.maxValue-config.minValue)*config.lowThreshhold,(config.maxValue-config.minValue)*config.lowMidThreshhold,(config.maxValue-config.minValue)*config.highMidThreshhold,(config.maxValue-config.minValue)*config.highThreshhold].map(this.scale);var colorRange=[config.lowThreshholdColor,config.lowMidThreshholdColor,config.defaultColor,config.highMidThreshholdColor,config.highThreshholdColor];this.colorScale=d3.scaleThreshold().domain(colorDomain).range(colorRange);this.ticks=[config.minValue,(config.maxValue-config.minValue)*config.lowThreshhold,(config.maxValue-config.minValue)*config.lowMidThreshhold,(config.maxValue-config.minValue)*config.highMidThreshhold,(config.maxValue-config.minValue)*config.highThreshhold,config.maxValue];this.threshholds=[config.minValue,(config.maxValue-config.minValue)*config.lowThreshhold,(config.maxValue-config.minValue)*config.lowMidThreshhold,(config.maxValue-config.minValue)*config.highMidThreshhold,(config.maxValue-config.minValue)*config.highThreshhold,config.maxValue].map(function(d){return _this.scale(d)});this.scale=d3.scaleLinear().range([0,1]).domain([config.minValue,config.maxValue]);this.arc=d3.arc().innerRadius(this._radius()-this.arcWidth-this.arcPadding).outerRadius(this._radius()-this.arcPadding).startAngle(function(d,i){var ratio=i>0?_this.threshholds[i-1]:_this.threshholds[0];return _this._deg2rad(_this.minAngle+ratio*_this.angleRange)}).endAngle(function(d,i){return _this._deg2rad(_this.minAngle+_this.threshholds[i]*_this.angleRange)})}_createClass(Gauge,[{key:"_radius",value:function _radius(){return this.mwidth*.5}},{key:"_deg2rad",value:function _deg2rad(deg){return deg*Math.PI/180}},{key:"render",value:function render(newValue){var _this2=this;var svg=d3.select(this.config.container).append("svg").attr("class","gauge").attr("width",this.mwidth).attr("height",this.mheight);var arcs=svg.append("g").attr("class","arc").attr("transform","translate(".concat(this._radius(),", ").concat(this._radius(),")"));arcs.selectAll("path").data(this.threshholds).enter().append("path").attr("fill",function(d){return _this2.colorScale(d-.001)}).attr("d",this.arc);svg.append("g").attr("class","label").attr("transform","translate(".concat(this._radius(),",").concat(this._radius(),")"));this._displayLabel();var pg=svg.append("g").data([this.lineData]).attr("class","pointer").attr("transform","translate(".concat(this._radius(),",").concat(this._radius(),")"));var arc=d3.arc().innerRadius(this.mwidth*.03).outerRadius(0).startAngle(0).endAngle(2*Math.PI);var pointer=pg.append("path").attr("d",d3.line()).attr("transform","rotate(".concat(this.minAngle,")"));var arc_pointer=pg.append("path").attr("class","arc_pointer").attr("d",arc).attr("transform","rotate(".concat(this.minAngle,")"));var numberDiv=d3.select(this.config.container).append("div").attr("class","number-div").style("width","".concat(this.mwidth,"px"));var numberUnit=numberDiv.append("span").attr("class","number-unit").html(function(d){return _this2.config.displayUnit});var numberValue=numberDiv.append("span").data([newValue]).attr("class","number-value").text(function(d){return d===undefined?0:d});this.pointer=pointer;this.numberValue=numberValue}},{key:"_displayLabel",value:function _displayLabel(){var _this3=this;$(this.config.container+" .gauge .label").empty();var lg=d3.select(this.config.container+" .label");lg.selectAll("text").data(this.ticks).enter().append("text").attr("transform",function(d){var newAngle=_this3.minAngle+_this3.scale(d)*_this3.angleRange;return"rotate(".concat(newAngle,") translate(0, ").concat(_this3.labelInset-_this3._radius(),")")}).text(d3.format("1.0f"));lg.selectAll("line").data(this.ticks).enter().append("line").attr("class","tickline").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",this.arcWidth+this.labelInset).attr("stroke-width",this.mwidth*.015).attr("transform",function(d){var newAngle=_this3.minAngle+_this3.scale(d)*_this3.angleRange;return"rotate(".concat(newAngle,"), translate(0, ").concat(_this3.arcWidth-_this3.labelInset-_this3._radius(),")")})}},{key:"update",value:function update(newValue,maxValue){var value=newValue;if(!maxValue)this.config.maxValue=maxValue;if(!newValue)value=0;this.ticks=[this.config.minValue,(this.config.maxValue-this.config.minValue)*this.config.lowThreshhold,(this.config.maxValue-this.config.minValue)*this.config.lowMidThreshhold,(this.config.maxValue-this.config.minValue)*this.config.highMidThreshhold,(this.config.maxValue-this.config.minValue)*this.config.highThreshhold,this.config.maxValue];this.scale=d3.scaleLinear().range([0,1]).domain([this.config.minValue,this.config.maxValue]);this._displayLabel();var newAngle=this.minAngle+this.scale(value)*this.angleRange;this.pointer.transition().duration(this.config.transitionMs).attr("transform","rotate(".concat(newAngle,")"));if(value===0){this.numberValue.transition().duration(this.config.transitionMs).style("color","black").text("ND")}else{if(this.numberValue.text()==="ND")this.numberValue.text(0);this.numberValue.data([value]).transition().duration(this.config.transitionMs).style("color",this.colorScale(this.scale(value))).tween("",function(d){var interpolator=d3.interpolate(this.textContent,d);var that=this;return function(t){that.textContent=interpolator(t).toFixed(1)}})}}}]);return Gauge}();exports.Gauge=Gauge}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.initGauges=initGauges;var d3Gauge=_interopRequireWildcard(require("../D3gauge"));function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};if(obj!=null){var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj)}return newObj}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}}function initGauges(data){var basalAreaMax=10;var hMeanMax=10;var shannonMax=10;var pielouMax=10;var simpsonMax=10;var woodDensityMax=1;var biomasseMax=10;var richessMax=10;var speciesLevelMax=100;function initMax(maxValue,initMaxValue){if(maxValue===0){return initMaxValue}else{return maxValue}}function initGauge(id,unit,maxValue){return new d3Gauge.Gauge({width:$(id).width(),height:$(id).height(),displayUnit:unit,container:id,maxValue:maxValue})}var basalArea=Math.max.apply(Math,_toConsumableArray(Array.from(data.map(function(e){return e.basal_area}).values())));basalAreaMax=initMax(basalArea,basalAreaMax);var basalAreaGauge=initGauge("#basalAreaGauge","m².ha<sup>-1</sup>",basalAreaMax);basalAreaGauge.render();var hMean=Math.max.apply(Math,_toConsumableArray(Array.from(data.map(function(e){return e.h_mean}).values())));hMeanMax=initMax(hMean,hMeanMax);var hMeanGauge=initGauge("#hMeanGauge","m",hMeanMax);hMeanGauge.render();var shannon=Math.max.apply(Math,_toConsumableArray(Array.from(data.map(function(e){return e.shannon}).values())));shannonMax=initMax(shannon,shannonMax);var shannonGauge=initGauge("#shannonGauge","SI",shannonMax);shannonGauge.render();var pielou=Math.max.apply(Math,_toConsumableArray(Array.from(data.map(function(e){return e.pielou}).values())));pielouMax=initMax(pielou,pielouMax);var pielouGauge=initGauge("#pielouGauge","SI",pielouMax);pielouGauge.render();var simpson=Math.max.apply(Math,_toConsumableArray(Array.from(data.map(function(e){return e.simpson}).values())));simpsonMax=initMax(simpson,simpsonMax);var simpsonGauge=initGauge("#simpsonGauge","SI",simpsonMax);simpsonGauge.render();var woodDensity=Math.max.apply(Math,_toConsumableArray(Array.from(data.map(function(e){return e.wood_density}).values())));woodDensityMax=initMax(woodDensity,woodDensityMax);var woodDensityGauge=initGauge("#woodDensityGauge","kg.m"+"-3".sup(),woodDensityMax*1e3);woodDensityGauge.render();var biomasse=Math.max.apply(Math,_toConsumableArray(Array.from(data.map(function(e){return e.biomasse}).values())));biomasseMax=initMax(biomasse,biomasseMax);var biomasseGauge=initGauge("#biomasseGauge","SI",biomasseMax);biomasseGauge.render();var richess=Math.max.apply(Math,_toConsumableArray(Array.from(data.map(function(e){return e.count_species}).values())));richessMax=initMax(richess,richessMax);var richessGauge=initGauge("#richessGauge","nombre d espèces ",richessMax);richessGauge.render();var speciesLevelGauge=initGauge("#speciesLevelGauge","%",speciesLevelMax);speciesLevelGauge.render();$("#plot_select").on("plotSelected",function(event,data){updateData(data)});function updateData(data){basalAreaGauge.update(data.properties.basal_area,basalAreaMax);hMeanGauge.update(data.properties.h_mean,hMeanMax);shannonGauge.update(data.properties.shannon,shannonMax);pielouGauge.update(data.properties.pielou,pielouMax);simpsonGauge.update(data.properties.simpson,simpsonMax);woodDensityGauge.update(data.properties.wood_density*1e3,woodDensityMax*1e3);biomasseGauge.update(data.properties.biomasse,biomasseMax);richessGauge.update(data.properties.richess,richessMax);speciesLevelGauge.update(data.properties.species_level*speciesLevelMax,speciesLevelMax)}}},{"../D3gauge":1}],3:[function(require,module,exports){"use strict";var restUrls=_interopRequireWildcard(require("../restUrls"));var d3Gauges=_interopRequireWildcard(require("./d3Gauges"));var preloader=_interopRequireWildcard(require("../preloader"));function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};if(obj!=null){var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj)}return newObj}var plotList=restUrls.plotList;function buildPlotList(){var plots={};$.ajax({type:"GET",data:{ordering:"name"},url:plotList,success:function success(result){d3Gauges.initGauges(result);plots=result.reduce(function(map,obj){map[obj.id]=obj;return map},{});var select=document.getElementById("plot_select");result.map(function(x){var option=document.createElement("option");option.text=x.label;option.value=x.id;select.add(option)});$("#plot_select").selectpicker({noneSelectedText:"Selectionnez une parcelle"});$("#plot_select").selectpicker("val",null);$("#plot_select").change(function(){preloader.showPreloader();updateData(plots[this.value])});preloader.hidePreloader()}})}function updateData(plot){$.ajax({type:"GET",url:plotList+plot.id+"/",success:function success(response){$("#plot_select").trigger("plotSelected",response);preloader.hidePreloader()}})}document.addEventListener("DOMContentLoaded",function(){$("#preloader").on("elementLoaded",function(event,data){preloader.hidePreloader()});buildPlotList()})},{"../preloader":4,"../restUrls":5,"./d3Gauges":2}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.showPreloader=showPreloader;exports.hidePreloader=hidePreloader;function showPreloader(){document.getElementById("preloader").style.display="inline"}function hidePreloader(){document.getElementById("preloader").style.display="none"}},{}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.plotList=void 0;var host=window.location.host;var protocol=window.location.protocol;var apiRoot=protocol+"//"+host+"/api/1.0";var plotList=apiRoot+"/Plot/";exports.plotList=plotList},{}]},{},[3]);
