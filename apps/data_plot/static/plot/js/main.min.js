var host = window.location.host;
var protocol = window.location.protocol;
var api_root = protocol + "//" + host + "/api/1.0";

const plot_list = api_root + "/Plot/";

function showPreloader() {
    document.getElementById('preloader').style.display = 'inline';
}

function hidePreloader() {
    document.getElementById('preloader').style.display = 'none';
};

function buildPlotList() {
    var plots = {};

    $.ajax({
        type: 'GET',
        data: {
            ordering: "name"
        },
        url: plot_list,
        success: function (result) {
            // d3_gauges.initGauges(result);
            plots = result.reduce(function (map, obj) {
                map[obj.id] = obj;
                return map;
            }, {});
            console.log(result);
            var select = document.getElementById("plot_select");
            result.map(function (x) {
                var option = document.createElement('option');
                option.text = x.label;
                option.value = x.id;
                select.add(option);
            });
            $('#plot_select').selectpicker({
                noneSelectedText: "Selectionnez une parcelle"
            });
            $('#plot_select').selectpicker('val', null);
            $('#plot_select').change(function () {
                // showPreloader();
                updateData(plots[this.value]);
            })
        }
    });
};

$(document).ready(function () {
    // $('#preloader').on('elementLoaded', function (event, data) {
    // hidePreloader();
    // })
    buildPlotList();
    // d3_map.initMap();
    // d3_families_donut.initFamiliesDonut("#families_donut");
    // // d3_species_donut.initSpeciesDonut("#species_donut");
    // d3_species_barh.initSpeciesDonut("#species_donut");
    // d3_diameters.initDiametersHistogram();
    // d3_strates.initBarh();
    // d3_stems.initStems();
    // d3_type_plant.initTypePlantDonut("#type_plant_donut");
});