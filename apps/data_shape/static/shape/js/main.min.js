(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){(function(global){"use strict";function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}Object.defineProperty(exports,"__esModule",{value:true});exports.GraphBarh=void 0;var d3=_interopRequireWildcard(typeof window!=="undefined"?window["d3"]:typeof global!=="undefined"?global["d3"]:null);function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj)}return newObj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var GraphBarh=function(){function GraphBarh(configuration){_classCallCheck(this,GraphBarh);var config={height:200,width:200,margin:10,minValue:0,maxValue:100,majorTicks:5,color:["#444","#aaa","#eee"],transitionMs:1e3,displayUnit:"Value",container:"",title:"",xLabel:"",yLabel:"",value:"",legend:""};this.config=Object.assign(config,configuration);this.margin={top:this.config.height*.003,right:this.config.width*.03,bottom:this.config.height*.2,left:this.config.width*.15};this.mheight=this.config.height-this.margin.top-this.margin.bottom;this.mwidth=this.config.width-this.margin.left-this.margin.right;this.svg=d3.select(this.config.container).append("svg").attr("width",this.config.width).attr("height",this.config.height);this.xAxis=this.svg.append("g").attr("class","xAxis").attr("transform","translate("+this.margin.left+","+(this.mheight+this.margin.top)+")");this.xGrid=this.svg.append("g").attr("class","xGrid").attr("transform","translate("+this.margin.left+","+(this.mheight+this.margin.top)+")");this.yAxis=this.svg.append("g").attr("class","yAxis").attr("transform","translate("+this.margin.left+","+this.margin.top+")");this.g=this.svg.append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")");this.svgLabel=this.svg.append("g").attr("class","label");this.svgLabel.append("text").attr("class","yLabel").attr("transform","rotate(-90)").attr("y",5).attr("x",0-this.config.height*.5).attr("dy",".71em").style("text-anchor","middle").text(this.config.yLabel);this.svgLabel.append("text").attr("class","xLabel").attr("y",this.config.height*.92).attr("x",this.config.width*.55).attr("dy",".71em").style("text-anchor","middle").text(this.config.xLabel);var svgLegend=d3.select(this.config.container+"Legend").append("svg").attr("width",this.mwidth).attr("height",this.mheight*.3);svgLegend.append("g").attr("class","legend").attr("transform","translate("+this.mwidth*.1+", "+0+")").attr("dy",".5em").attr("dx",".5em");var colorScale=d3.scaleOrdinal().domain(this.config.value).range(this.config.color);var legendColor=d3.legendColor().shapePadding(5).scale(colorScale).shapeWidth(10).shapeHeight(10);svgLegend.select(".legend").call(legendColor)}_createClass(GraphBarh,[{key:"render",value:function render(newValue){}},{key:"update",value:function update(response){var _this=this;var stack=d3.stack().keys(["forest","outForest"]).order(d3.stackOrderNone).offset(d3.stackOffsetNone);var data=stack(response);var yValue=response.map(function(d){return d.class_name});var xMax=d3.max(data,function(d){return d3.max(d,function(d){return d[1]})});var yScale=d3.scalePoint().domain(yValue).range([0,this.mheight]).padding(1);var xScale=d3.scaleLinear().domain([0,xMax]).range([0,this.mwidth]);var xGrid=function xGrid(g){return g.call(d3.axisBottom(xScale).tickSizeInner(-_this.mheight).ticks(6)).call(function(g){return g.selectAll(".domain").remove()}).call(function(g){return g.selectAll(".tick text").remove()})};var xAxis=function xAxis(g){return g.call(d3.axisBottom(xScale).ticks(6,"0f").tickSizeOuter(0))};var yAxis=function yAxis(g){return g.call(d3.axisLeft(yScale).tickValues(["100","300","500","700","900","1100","1300","1500","1700"]).tickSizeOuter(0))};this.svg.selectAll(".xAxis").transition().call(xAxis);this.svg.selectAll(".xGrid").transition().call(xGrid);this.svg.selectAll(".yAxis").call(yAxis);var layer=this.g.selectAll("g").data(data).join("g").attr("fill",function(d,i){return _this.config.color[i]}).attr("class",function(d,i){return _this.config.value[i]});var rects=layer.selectAll("rect").data(function(d){return d});rects.enter().append("rect").attr("x",function(d){return xScale(d[0])}).attr("y",function(d,i){return yScale(d.data.class_name)}).attr("width",function(d){return xScale(d[1])-xScale(d[0])}).attr("height",yScale.step());rects.transition().duration(500).attr("x",function(d){return xScale(d[0])}).attr("y",function(d,i){return yScale(d.data.class_name)}).attr("width",function(d){return xScale(d[1])-xScale(d[0])}).attr("height",yScale.step());rects.exit().transition().duration(500).remove()}}]);return GraphBarh}();exports.GraphBarh=GraphBarh}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.showPreloader=showPreloader;exports.hidePreloader=hidePreloader;function showPreloader(){document.getElementById("preloader").style.display="inline"}function hidePreloader(){document.getElementById("preloader").style.display="none"}},{}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.taxonTreeList=exports.taxonList=exports.shapeLocation=exports.shapeList=exports.plotList=void 0;var host=window.location.host;var protocol=window.location.protocol;var apiRoot=protocol+"//"+host+"/api/1.0";var plotList=apiRoot+"/Plot/";exports.plotList=plotList;var shapeList=apiRoot+"/Shape/";exports.shapeList=shapeList;var shapeLocation=apiRoot+"/ShapeLocation/";exports.shapeLocation=shapeLocation;var taxonList=apiRoot+"/Taxon/";exports.taxonList=taxonList;var taxonTreeList=apiRoot+"/TaxonTree/";exports.taxonTreeList=taxonTreeList},{}],4:[function(require,module,exports){"use strict";function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}Object.defineProperty(exports,"__esModule",{value:true});exports.initGraphBarhs=initGraphBarhs;var d3GraphBarh=_interopRequireWildcard(require("../d3GraphBarh"));function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj)}return newObj}function initGraphBarhs(data){function initMax(maxValue,initMaxValue){if(maxValue===0){return initMaxValue}else{return maxValue}}function initGraphBarh(id,xLabel,yLabel,value,legend){return new d3GraphBarh.GraphBarh({width:$(id).width(),height:$(id).height(),container:id,title:"",xLabel:xLabel,yLabel:yLabel,value:value,color:["#548235","#f5e9d8"]})}var forests=initGraphBarh("#forets","Superfice(hectare)","Alitude(m)",["forêt","hors-forêt"]);var forestsUm=initGraphBarh("#forets_um","Superfice(hectare)","Alitude(m)",["forêt","hors-forêt"]);$("#shape_select").on("shapeSelected",function(event,data){updateData(data.properties.frequencies)});function updateData(data){function dataFilter(data,field){var precision=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var result=data.filter(function(d){return d.class_object===field});return result}function classFilter(data,field){var result=data.filter(function(d){return d.class_object===field}).map(function(d){return d.class_name});return result}var elevation=classFilter(data,"land_elevation");var land=dataFilter(data,"land_elevation");var landUm=dataFilter(data,"land_um_elevation");var forest=dataFilter(data,"forest_elevation");var forestUm=dataFilter(data,"forest_um_elevation");var forestData=land.map(function(d,i){var result={class_name:d.class_name,forest:forest[i].class_value.toFixed(0),outForest:(d.class_value-forest[i].class_value).toFixed(0)};return result});var forestUmData=landUm.map(function(d,i){var result={class_name:d.class_name,forest:forestUm[i].class_value.toFixed(0),outForest:(d.class_value-forestUm[i].class_value).toFixed(0)};return result});forests.update(forestData.reverse());forestsUm.update(forestUmData.reverse())}}},{"../d3GraphBarh":1}],5:[function(require,module,exports){"use strict";function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}var restUrls=_interopRequireWildcard(require("../restUrls"));var preloader=_interopRequireWildcard(require("../preloader"));var d3GraphBarh=_interopRequireWildcard(require("./d3GraphBarhs"));function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj)}return newObj}var shapeList=restUrls.shapeList;var shapeLocation=restUrls.shapeLocation;var wmsUrlNC="http://carto.gouv.nc/arcgis/services/fond_imagerie/"+"MapServer/WMSServer";var layerBackground=new ol.layer.Tile({source:new ol.source.TileWMS({url:wmsUrlNC,params:{LAYERS:"0",TILED:true,FORMAT:"image/png"},serverType:"mapserver"})});var features=new ol.Collection;var source=new ol.source.Vector({features:features});var layerShape=new ol.layer.Vector({source:source});var view=new ol.View({projection:"EPSG:4326",center:new ol.proj.transform([165.875,-21.145],"EPSG:4326","EPSG:4326"),zoom:6});var map=new ol.Map({target:"mapCaledonie",view:view});map.addLayer(layerBackground);map.addLayer(layerShape);function buildShapeList(){var shapes={};$.ajax({type:"GET",data:{ordering:"label"},url:shapeList,success:function success(result){shapes=result.reduce(function(map,obj){map[obj.id]=obj;return map},{});var typeShape="";var select=document.getElementById("shape_select");var optgrp=document.createElement("optgroup");for(var idx in shapes){var option=document.createElement("option");if(typeShape!==shapes[idx].typeShape){optgrp=document.createElement("optgroup");typeShape=shapes[idx].typeShape;optgrp.label=typeShape;select.add(optgrp)}option.text=shapes[idx].label;option.value=shapes[idx].id;optgrp.append(option)}$("#shape_select").selectpicker({noneSelectedText:"Selectionnez une emprise"});$("#shape_select").selectpicker("val",null);$("#shape_select").change(function(){preloader.showPreloader();updateData(shapes[this.value])});preloader.hidePreloader()}})}function updateData(shape){$.ajax({type:"GET",url:shapeList+shape.id+"/",success:function success(response){$("#shape_select").trigger("shapeSelected",response);updateLayerShape(response);preloader.hidePreloader()}})}function updateLayerShape(data){source.clear();source.addFeature((new ol.format.GeoJSON).readFeature(data));var feature=source.getFeatures()[0];var polygon=feature.getGeometry();view.fit(polygon,{padding:[5,5,5,5]})}document.addEventListener("DOMContentLoaded",function(){$("#preloader").on("elementLoaded",function(event,data){preloader.hidePreloader()});buildShapeList();d3GraphBarh.initGraphBarhs()})},{"../preloader":2,"../restUrls":3,"./d3GraphBarhs":4}]},{},[5]);
