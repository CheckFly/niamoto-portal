$(document).ready(function(){$(".tablesorter").tablesorter({theme:"ice",widgets:["zebra","scroller"],widgetOptions:{}})});
(function(c,x){function t(b){var a=d.forEachFeatureAtPixel(b,function(a,b){return a});a&&(b=a.get("key_name"),n(a),a=c("#massif_table").offset().top,b=c("#"+b).offset().top-a,c(".tablesorter-scroller-table").animate({scrollTop:b},500))}function n(b){k=b.get("key_name");b.get("id");var a=b.get("key_name");b=b.get("full_name");var d=massif_data[a].operator,e=massif_data[a].status_display,f=massif_data[a].status,p="";massif_data[a].file_available&&0<f&&(p='<a href="'+a+"/\">Consulter l'\u00e9tat actuel de la digitalisation</a>");
a=["<h3>"];a.push(b);a.push("</h3>");a.push("Digitalis\u00e9 par: ");a.push(d);a.push("</p>");a.push("<p>");a.push("Status: ");a.push(e);a.push("</p>");a.push(p);c("#detail_content").html(a.join(""));h.changed();a=c("#"+k);g&&g.removeClass("selected");g=a;g.addClass("selected")}function u(){var b=ol.animation.pan({duration:800,source:f.getCenter()}),a=ol.animation.zoom({duration:800,resolution:f.getResolution()});d.beforeRender(b,a);f.fitExtent(h.getExtent(),d.getSize())}function q(){var b=.85*c("#content").height();
c(".column").css("height",b+"px");b=c(".tablesorter-scroller-header").height();b=c("#massif_form").height()-b;c(".tablesorter-scroller-table").css({height:b-1+"px","max-height":"none"});d.updateSize()}var l,h,m;proj4.defs("EPSG:32758","+proj=utm +zone=58 +south +datum=WGS84 +units=m +no_defs");var f=new ol.View({projection:"EPSG:32758",center:new ol.proj.transform([165.875,-21.145],"EPSG:4326","EPSG:32758"),zoom:7.5}),d=new ol.Map({target:"map",layers:[new ol.layer.Tile({source:new ol.source.TileWMS({url:"http://carto.gouv.nc/arcgis/services/fond_imagerie/MapServer/WMSServer",
params:{LAYERS:"0",FORMAT:"image/png",CRS:"EPSG:32758"},serverType:"mapserver"})})],view:f,controls:[new ol.control.Zoom,new olext.control.CurrentScale,new olext.control.SetScale(3E3)]}),k=null,g=null,v=olext.utils.makeStyle({fill_color:"rgba(0, 0, 0, 0.2)",stroke_color:"#FFFFFF",stroke_width:1}),r=new ol.FeatureOverlay({map:d,style:v}),e;popup=new olext.overlay.Popup({positioning:"bottom-center"});d.addOverlay(popup);var w=function(b,a){a=d.getEventPixel(b.originalEvent);var c=d.forEachFeatureAtPixel(a,
function(a,b){return a});c&&popup.setPosition(b.coordinate);c!==e&&(e&&r.removeFeature(e),(e=c)?(r.addFeature(e),popup.setContent(e.get("full_name"))):popup.hide())};c(document).ready(function(){function b(a){var b=olext.utils.makeStyle({fill_color:"rgba(51, 133, 214, 0.9)",stroke_color:"rgb(174, 194, 214)",stroke_width:1}),e=olext.utils.makeStyle({fill_color:"rgba(255, 120, 120, 0.5)",stroke_color:"rgb(255, 120, 120)",stroke_width:1}),f=olext.utils.makeStyle({fill_color:"rgba(255, 163, 0, 0.5)",
stroke_color:"rgb(255, 163, 0)",stroke_width:1}),g=olext.utils.makeStyle({fill_color:"rgba(120, 255, 120, 0.5)",stroke_color:"rgb(120, 255, 120)",stroke_width:1});m=window.olext.utils.makeGeoJSONLayer(a,{style:function(a,c){k_n=a.get("key_name");status=massif_data[k_n].status;if(k_n==k)return[b];var d=[ol.style.Style()];switch(status){case "0":d=[e];break;case "1":d=[f];break;case "2":d=[g]}return d},image_vector:!0});d.addLayer(m);h=m.getSource().getSource();l={};h.forEachFeature(function(a){l[a.get("key_name")]=
a;return!1});d.on("pointermove",function(a){a.dragging||w(a)});d.on("click",function(a){t(a.pixel)});c(".massif_button").click(function(){var a=c(this).attr("value");n(l[a])});u()}c.ajax({url:geoserver_base_url+"niamoto/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=niamoto:niamoto_data_massif&outputFormat=application%2Fjson&srsname=EPSG:32758&",dataType:"json",jsonp:!1,success:function(a){b(a)}});c(window).resize(q);q()})})(jQuery);
