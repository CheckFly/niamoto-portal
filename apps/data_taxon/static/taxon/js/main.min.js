(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){(function(global){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Gauge=void 0;typeof window!=="undefined"?window["d3"]:typeof global!=="undefined"?global["d3"]:null;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var Gauge=function(){function Gauge(configuration){var _this=this;_classCallCheck(this,Gauge);var config={height:200,width:200,margin:10,minValue:0,maxValue:10,majorTicks:5,lowThreshhold:.2,lowMidThreshhold:.4,highMidThreshhold:.6,highThreshhold:.8,lowThreshholdColor:"#f02828",lowMidThreshholdColor:"#fe6a00",defaultColor:"#e8dd11",highMidThreshholdColor:"#82e042",highThreshholdColor:"#089f50",container:"",transitionMs:500};this.config=Object.assign(config,configuration);this.margin={top:this.config.height*.1,right:this.config.width*.05,bottom:this.config.height*-.05,left:this.config.width*.05};this.mheight=this.config.height-this.margin.top-this.margin.bottom;this.mwidth=this.config.height*2-this.margin.left-this.margin.right;this.arcPadding=this.mwidth*.075;this.arcWidth=this.mwidth*.1;this.labelInset=this.mwidth*.05;var pointerWidth=this.mwidth*.025;var pointerTailLength=this.mwidth*.025;var pointerHeadLength=this.mwidth*.4;this.lineData=[[pointerWidth,0],[0,-pointerHeadLength],[-pointerWidth,0],[0,pointerTailLength],[pointerWidth,0]];this.minAngle=-90,this.maxAngle=90,this.angleRange=this.maxAngle-this.minAngle;this.scale=d3.scaleLinear().range([0,1]).domain([config.minValue,config.maxValue]);var colorDomain=[(config.maxValue-config.minValue)*config.lowThreshhold,(config.maxValue-config.minValue)*config.lowMidThreshhold,(config.maxValue-config.minValue)*config.highMidThreshhold,(config.maxValue-config.minValue)*config.highThreshhold].map(this.scale);var colorRange=[config.lowThreshholdColor,config.lowMidThreshholdColor,config.defaultColor,config.highMidThreshholdColor,config.highThreshholdColor];this.colorScale=d3.scaleThreshold().domain(colorDomain).range(colorRange);this.ticks=[config.minValue,(config.maxValue-config.minValue)*config.lowThreshhold,(config.maxValue-config.minValue)*config.lowMidThreshhold,(config.maxValue-config.minValue)*config.highMidThreshhold,(config.maxValue-config.minValue)*config.highThreshhold,config.maxValue];this.threshholds=[config.minValue,(config.maxValue-config.minValue)*config.lowThreshhold,(config.maxValue-config.minValue)*config.lowMidThreshhold,(config.maxValue-config.minValue)*config.highMidThreshhold,(config.maxValue-config.minValue)*config.highThreshhold,config.maxValue].map(function(d){return _this.scale(d)});this.scale=d3.scaleLinear().range([0,1]).domain([config.minValue,config.maxValue]);this.arc=d3.arc().innerRadius(this._radius()-this.arcWidth-this.arcPadding).outerRadius(this._radius()-this.arcPadding).startAngle(function(d,i){var ratio=i>0?_this.threshholds[i-1]:_this.threshholds[0];return _this._deg2rad(_this.minAngle+ratio*_this.angleRange)}).endAngle(function(d,i){return _this._deg2rad(_this.minAngle+_this.threshholds[i]*_this.angleRange)})}_createClass(Gauge,[{key:"_radius",value:function _radius(){return this.mwidth*.5}},{key:"_deg2rad",value:function _deg2rad(deg){return deg*Math.PI/180}},{key:"render",value:function render(newValue){var _this2=this;var svg=d3.select(this.config.container).append("svg").attr("class","gauge").attr("width",this.mwidth).attr("height",this.mheight);var arcs=svg.append("g").attr("class","arc").attr("transform","translate(".concat(this._radius(),", ").concat(this._radius(),")"));arcs.selectAll("path").data(this.threshholds).enter().append("path").attr("fill",function(d){return _this2.colorScale(d-.001)}).attr("d",this.arc);svg.append("g").attr("class","label").attr("transform","translate(".concat(this._radius(),",").concat(this._radius(),")"));this._displayLabel();var pg=svg.append("g").data([this.lineData]).attr("class","pointer").attr("transform","translate(".concat(this._radius(),",").concat(this._radius(),")"));var arc=d3.arc().innerRadius(this.mwidth*.03).outerRadius(0).startAngle(0).endAngle(2*Math.PI);var pointer=pg.append("path").attr("d",d3.line()).attr("transform","rotate(".concat(this.minAngle,")"));var arc_pointer=pg.append("path").attr("class","arc_pointer").attr("d",arc).attr("transform","rotate(".concat(this.minAngle,")"));var numberDiv=d3.select(this.config.container).append("div").attr("class","number-div").style("width","".concat(this.mwidth,"px"));var numberUnit=numberDiv.append("span").attr("class","number-unit").html(function(d){return _this2.config.displayUnit});var numberValue=numberDiv.append("span").data([newValue]).attr("class","number-value").text(function(d){return d===undefined?0:d});this.pointer=pointer;this.numberValue=numberValue}},{key:"_displayLabel",value:function _displayLabel(){var _this3=this;$(this.config.container+" .gauge .label").empty();var lg=d3.select(this.config.container+" .label");lg.selectAll("text").data(this.ticks).enter().append("text").attr("transform",function(d){var newAngle=_this3.minAngle+_this3.scale(d)*_this3.angleRange;return"rotate(".concat(newAngle,") translate(0, ").concat(_this3.labelInset-_this3._radius(),")")}).text(d3.format("1.0f"));lg.selectAll("line").data(this.ticks).enter().append("line").attr("class","tickline").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",this.arcWidth+this.labelInset).attr("stroke-width",this.mwidth*.015).attr("transform",function(d){var newAngle=_this3.minAngle+_this3.scale(d)*_this3.angleRange;return"rotate(".concat(newAngle,"), translate(0, ").concat(_this3.arcWidth-_this3.labelInset-_this3._radius(),")")})}},{key:"update",value:function update(newValue,maxValue){var value=newValue;if(!maxValue)this.config.maxValue=maxValue;if(!newValue)value=0;this.ticks=[this.config.minValue,(this.config.maxValue-this.config.minValue)*this.config.lowThreshhold,(this.config.maxValue-this.config.minValue)*this.config.lowMidThreshhold,(this.config.maxValue-this.config.minValue)*this.config.highMidThreshhold,(this.config.maxValue-this.config.minValue)*this.config.highThreshhold,this.config.maxValue];this.scale=d3.scaleLinear().range([0,1]).domain([this.config.minValue,this.config.maxValue]);this._displayLabel();var newAngle=this.minAngle+this.scale(value)*this.angleRange;this.pointer.transition().duration(this.config.transitionMs).attr("transform","rotate(".concat(newAngle,")"));if(value===0){this.numberValue.transition().duration(this.config.transitionMs).style("color","black").text("ND")}else{if(this.numberValue.text()==="ND")this.numberValue.text(0);this.numberValue.data([value]).transition().duration(this.config.transitionMs).style("color",this.colorScale(this.scale(value))).tween("",function(d){var interpolator=d3.interpolate(this.textContent,d);var that=this;return function(t){that.textContent=interpolator(t).toFixed(1)}})}}}]);return Gauge}();exports.Gauge=Gauge}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.showPreloader=showPreloader;exports.hidePreloader=hidePreloader;function showPreloader(){document.getElementById("preloader").style.display="inline"}function hidePreloader(){document.getElementById("preloader").style.display="none"}},{}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.taxonTreeList=exports.taxonList=exports.shapeList=exports.plotList=void 0;var host=window.location.host;var protocol=window.location.protocol;var apiRoot=protocol+"//"+host+"/api/1.0";var plotList=apiRoot+"/Plot/";exports.plotList=plotList;var shapeList=apiRoot+"/Shape/";exports.shapeList=shapeList;var taxonList=apiRoot+"/Taxon/";exports.taxonList=taxonList;var taxonTreeList=apiRoot+"/TaxonTree/";exports.taxonTreeList=taxonTreeList},{}],4:[function(require,module,exports){"use strict";function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}Object.defineProperty(exports,"__esModule",{value:true});exports.initGauges=initGauges;var d3Gauge=_interopRequireWildcard(require("../D3gauge"));function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj)}return newObj}function initGauges(data){var dbhMax=150;var dbhMin=0;var woodDensityMax=1;var woodDensityMin=0;var rainfallMax=4500;var rainfallMin=0;var heightMax=40;var heightMin=0;var plotsCount=20;function initMax(maxValue,initMaxValue){if(maxValue===0){return initMaxValue}else{return maxValue}}function initGauge(id,unit,minValue,maxValue){return new d3Gauge.Gauge({width:$(id).width(),height:$(id).height(),displayUnit:unit,container:id,minValue:minValue,maxValue:maxValue})}var dbhMaxGauge=initGauge("#dbhMaxGauge","cm",0,dbhMax);dbhMaxGauge.render();var distributionOccGauge=initGauge("#distributionOccGauge","nombre d'occurence",0,20);distributionOccGauge.render();var woodDensityGauge=initGauge("#woodDensityGauge","kg.m"+"-3".sup(),0,woodDensityMax*1e3);woodDensityGauge.render();var rainfallMinGauge=initGauge("#pluvioMinGauge","mm.an"+"-1".sup(),0,rainfallMax);rainfallMinGauge.render();var heightMaxGauge=initGauge("#heightMaxGauge","m",0,heightMax);heightMaxGauge.render();var distributionGeoGauge=initGauge("#distributionGeoGauge","nombre de parcelles",0,plotsCount);distributionGeoGauge.render();var sizePopGauge=initGauge("#sizePopGauge","Fréquence sur chaque parcelle",0,plotsCount);sizePopGauge.render();$("#taxon_treeview").on("taxonSelected",function(event,data){updateData(data)});function updateData(data){}}},{"../D3gauge":1}],5:[function(require,module,exports){(function(global){"use strict";function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}Object.defineProperty(exports,"__esModule",{value:true});exports.initPhenologyHisto=initPhenologyHisto;var d3=_interopRequireWildcard(typeof window!=="undefined"?window["d3"]:typeof global!=="undefined"?global["d3"]:null);function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj)}return newObj}function initPhenologyHisto(){var month=["janvier","février","mars","avril","mai","juin","juillet","aout","septembre","octobre","novembre","decembre"];var label=["Fleur","Fruit"];var color=["#ffbb11","#ee0000"];var height=$("#phenologyHisto").height();var width=$("#phenologyHisto").width();var margin={top:height*.08,right:width*.07,bottom:height*.19,left:width*.12};var mheight=height-margin.top-margin.bottom;var mwidth=width-margin.left-margin.right;var svg=d3.select("#phenologyHisto").append("svg").attr("width",width).attr("height",height);var svgLegend=d3.select("#phenologyHistoLegend").append("svg").attr("width",width).attr("height",height*.25);var xDomain=month;var yDomain=[0,100];var xScale=d3.scaleBand().range([0,mwidth]).domain(xDomain).padding(.1);var yScale=d3.scaleLinear().range([mheight-25,0]).domain(yDomain);var xAxis=d3.axisBottom(xScale).ticks(10);var yAxis=d3.axisLeft(yScale).ticks(5);var g=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")");svg.append("g").attr("transform","translate("+margin.left+","+(mheight+margin.top-25)+")").attr("class","xAxis").call(xAxis).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-65)");svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")").attr("class","yAxis").call(yAxis);svg.append("text").attr("transform","rotate(-90)").attr("y",margin.left-50).attr("x",0-height/2).attr("dy","1em").style("text-anchor","middle").text("Fréquence");svgLegend.append("g").attr("class","legend").attr("transform","translate("+width*.1+", "+0+")");var colorScale=d3.scaleOrdinal().domain(label).range(color);var legendColor=d3.legendColor().shapePadding(5).scale(colorScale);svgLegend.select(".legend").call(legendColor);$("#taxon_treeview").on("taxonSelected",function(event,data){updateData(data)});function updateData(taxon){var dataFruit=[taxon.phenology[0].january,taxon.phenology[0].february,taxon.phenology[0].march,taxon.phenology[0].april,taxon.phenology[0].may,taxon.phenology[0].june,taxon.phenology[0].july,taxon.phenology[0].august,taxon.phenology[0].september,taxon.phenology[0].october,taxon.phenology[0].november,taxon.phenology[0].december];var dataFleur=[taxon.phenology[0].january,taxon.phenology[1].february,taxon.phenology[1].march,taxon.phenology[1].april,taxon.phenology[1].may,taxon.phenology[1].june,taxon.phenology[1].july,taxon.phenology[1].august,taxon.phenology[1].september,taxon.phenology[1].october,taxon.phenology[1].november,taxon.phenology[1].december];var data=[];for(var i=0;i<month.length;i++){data[i]={fleur:dataFleur[i],fruit:dataFruit[i],mois:month[i]}}var rects=g.selectAll(".bar").data(data);rects.enter().append("rect").attr("class","bar1").attr("x",function(d){return xScale(d.mois)}).attr("y",function(d){return yScale(d.fleur)}).style("fill",color[0]).attr("width",function(d){return xScale.bandwidth()/2}).attr("height",function(d){return mheight-yScale(d.fleur)-25});rects.enter().append("rect").attr("class","bar2").attr("x",function(d){return xScale(d.mois)+xScale.bandwidth()/2}).attr("y",function(d){return yScale(d.fruit)}).style("fill",color[1]).attr("width",function(d){return xScale.bandwidth()/2}).attr("height",function(d){return mheight-yScale(d.fruit)-25});rects.transition().duration(500).attr("x",function(d){return xScale(d.mois)}).attr("transform",function(d){return"translate("+0+","+yScale(d.fleur)+")"}).attr("width",function(d){return xScale.bandwidth()/2}).attr("height",function(d){return mheight-yScale(d.fleur)-25});rects.exit().transition().duration(500).remove()}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],6:[function(require,module,exports){"use strict";function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}var restUrls=_interopRequireWildcard(require("../restUrls"));var d3Gauges=_interopRequireWildcard(require("./d3Gauges"));var d3PhenologyHisto=_interopRequireWildcard(require("./d3PhenologyHisto.js"));var preloader=_interopRequireWildcard(require("../preloader"));var _taxonomy=require("./taxonomy");function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj)}return newObj}var taxonTreeList=restUrls.taxonTreeList;function buildTaxonList(){var taxons={};$.ajax({type:"GET",url:taxonTreeList,success:function success(result){d3Gauges.initGauges(result);var tree=new TreeView(result,"taxon_treeview","list-group-item");preloader.hidePreloader()}})}function updateData(taxon){$.ajax({type:"GET",url:restUrls.taxonList+taxon.id+"/",success:function success(response){$("#taxon_treeview").trigger("taxonSelected",response);updateGeneralInformations(response);preloader.hidePreloader()}})}function updateGeneralInformations(data){$("#tax_endemia_link_value").attr("href","http://endemia.nc/flore/fiche"+data.id_endemia);$("#tax_endemia_link_value").text("fiche "+data.full_name);$("#tax_full_name").html(data.full_name)}function makeNode(node){node.text=node.rank_name;node.icon="fas";node.state={expanded:false}}function makeLeaf(node){node.icon=""}document.addEventListener("DOMContentLoaded",function(){$("#preloader").on("elementLoaded",function(event,data){preloader.hidePreloader()});(0,_taxonomy.getTaxaTree)(function(taxaTree){$("#taxon_treeview").treeview({data:taxaTree,expandIcon:"fas fa-plus",collapseIcon:"fas fa-minus",emptyIcon:"fas",nodeIcon:"",selectedIcon:"",selectedBackColor:"#688BA5",onNodeSelected:function onNodeSelected(event,node){preloader.showPreloader();updateData(node)}});preloader.hidePreloader()},{make_node:makeNode,make_leaf:makeLeaf});d3Gauges.initGauges(null);d3PhenologyHisto.initPhenologyHisto()})},{"../preloader":2,"../restUrls":3,"./d3Gauges":4,"./d3PhenologyHisto.js":5,"./taxonomy":7}],7:[function(require,module,exports){"use strict";function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}Object.defineProperty(exports,"__esModule",{value:true});exports.getTaxaTree=getTaxaTree;var restUrls=_interopRequireWildcard(require("../restUrls"));function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj)}return newObj}function getTaxaTreeFromTaxaList(taxa_list,options){options=options||{};var id_attr=options.id_attr||"id";var make_node=options.make_node||null;var parent_attr=options.parent_attr||"parent_id";var nodes_attr=options.nodes_attr||"nodes";var make_leaf=options.make_leaf||null;var tax_dict={};var tree=[];for(var i=0;i<taxa_list.length;i++){var taxon=taxa_list[i];taxon[nodes_attr]=[];if(make_node!=null){make_node(taxon)}tax_dict[taxon[id_attr]]=taxon}for(var tax_id in tax_dict){var tax=tax_dict[tax_id];if(tax[parent_attr]!=null){tax_dict[tax[parent_attr]][nodes_attr].push(tax)}}for(var i=0;i<taxa_list.length;i++){var tax=tax_dict[taxa_list[i][id_attr]];if(tax[nodes_attr].length==0){tax[nodes_attr]=null;if(make_leaf!=null){make_leaf(tax)}}if(tax[parent_attr]==null){tree.push(tax)}}return tree}function getTaxaTree(_success,options){$.ajax({type:"GET",url:restUrls.taxonList,success:function success(result){options=options||null;var taxaList=result;var taxaTree=getTaxaTreeFromTaxaList(taxaList,options);_success(taxaTree)}})}},{"../restUrls":3}]},{},[6]);
